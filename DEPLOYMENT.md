# HappyTube Deployment Guide

This guide explains how to deploy the HappyTube web player to GitHub Pages.

## Prerequisites

- A GitHub repository with the HappyTube code
- Video data generated by running `poetry run python -m happytube.main`

## GitHub Pages Setup

### 1. Enable GitHub Pages

1. Go to your repository on GitHub
2. Click on **Settings** → **Pages**
3. Under **Source**, select **GitHub Actions**

### 2. Configure the Workflow

The workflow file is located at `.github/workflows/deploy.yml`. It will automatically:
- Install Python and Poetry
- Install project dependencies
- Export videos to static JSON format
- Deploy the static site to GitHub Pages

### 3. Trigger Deployment

The deployment will automatically run when:
- You push to the `main` branch
- You manually trigger it from the Actions tab

To manually trigger:
1. Go to **Actions** tab in your repository
2. Select **Deploy HappyTube to GitHub Pages**
3. Click **Run workflow**

## How It Works

1. **Build Step**:
   - Checks out the repository
   - Sets up Python 3.12 and Poetry
   - Installs dependencies (cached for faster builds)
   - Runs `poetry run python -m happytube.web.export` to generate `videos.json`
   - Uploads the `happytube/web/static` directory as a Pages artifact

2. **Deploy Step**:
   - Deploys the artifact to GitHub Pages
   - Your site becomes available at `https://<username>.github.io/<repository>/`

## Local Testing

Before deploying, you can test the static site locally:

```bash
# Generate the static files
poetry run python -m happytube.web.export

# Serve the static directory (using Python's HTTP server)
cd happytube/web/static
python -m http.server 8000

# Visit http://localhost:8000 in your browser
```

## Updating Video Data

To update the videos on your deployed site:

1. Run the pipeline locally to fetch new videos:
   ```bash
   poetry run python -m happytube.main
   ```

2. Commit and push the updated data files to the `main` branch:
   ```bash
   git add data/fetched/
   git commit -m "Update video data"
   git push origin main
   ```

3. The workflow will automatically rebuild and redeploy

## Troubleshooting

### No videos appear on the site

- Make sure you've run `poetry run python -m happytube.main` to fetch videos
- Check that `data/fetched/` directory contains JSON files
- Verify that `happytube/web/static/videos.json` was generated

### Workflow fails

- Check the Actions tab for error messages
- Ensure Python 3.12 compatibility
- Verify that all dependencies in `pyproject.toml` are correct

### Pages not updating

- Check that GitHub Pages is configured to use "GitHub Actions" as the source
- Verify the workflow completed successfully in the Actions tab
- Wait a few minutes for Pages to update (caching)
- Try a hard refresh in your browser (Ctrl+Shift+R or Cmd+Shift+R)

## Custom Domain (Optional)

To use a custom domain:

1. Add a `CNAME` file to `happytube/web/static/` with your domain:
   ```
   yourdomain.com
   ```

2. Configure your DNS provider to point to GitHub Pages:
   - Add a CNAME record pointing to `<username>.github.io`

3. In repository Settings → Pages, enter your custom domain

## Security Notes

- The workflow uses minimal permissions (read contents, write pages)
- No API keys are needed for deployment (the static export uses pre-fetched data)
- Make sure not to commit sensitive data to the repository
